{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Desktop\\\\poc\\\\demoreact\\\\src\\\\components\\\\SPM.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from \"react\";\nimport * as d3 from \"d3\";\nimport PropTypes from 'prop-types';\nimport { select } from \"d3\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ScatterPlotMatrix(props) {\n  _s();\n\n  //Sono i riferimenti ai g che ho costruito nel return.\n  let refSvg, svg;\n  let xAxis,\n      yAxis,\n      domainByTrait = {},\n      yScales = {},\n      xScales = {};\n  const size = props.size,\n        padding = props.padding,\n        legendRectSize = 18,\n        legendSpacing = 4;\n  const data = props.data;\n  const color = d3.scaleOrdinal(d3.schemeCategory10);\n  const traits = props.dims;\n  const numberOfTraits = traits.length;\n  console.log(props.dimColor);\n  console.log(props.data);\n  console.log(props.dims);\n\n  function cross(a, b) {\n    var c = [],\n        n = a.length,\n        m = b.length,\n        i,\n        j;\n\n    for (i = -1; ++i < n;) for (j = -1; ++j < m;) c.push({\n      x: a[i],\n      i: i,\n      y: b[j],\n      j: j\n    });\n\n    return c;\n  }\n\n  function plot(p) {\n    var cell = d3.select(this);\n    cell.append(\"rect\").attr(\"class\", \"frame\").attr(\"x\", padding / 2).attr(\"y\", padding / 2).attr(\"width\", size - padding).attr(\"height\", size - padding);\n    cell.selectAll(\"circle\").data(data).enter().append(\"circle\").transition().duration(500).attr(\"cx\", function (d) {\n      return xScales[p.x](d[p.x]);\n    }).attr(\"cy\", function (d) {\n      return yScales[p.y](d[p.y]);\n    }).attr(\"r\", 4).style(\"fill\", function (d) {\n      return color(d[props.dimColor]);\n    });\n  }\n\n  useEffect(() => {\n    svg = select(refSvg);\n    svg.attr(\"width\", size * numberOfTraits + padding + legendRectSize + 125);\n    svg.attr(\"height\", size * numberOfTraits + padding); //svg.attr(\"viewBox\", \"0 0 \" + (size * numberOfTraits + padding + legendRectSize + 125) + \" \" + (size * numberOfTraits + padding))\n\n    update();\n  });\n\n  function updateScales() {\n    traits.forEach(function (trait) {\n      domainByTrait[trait] = d3.extent(data, function (d) {\n        return +d[trait];\n      });\n      let xScale, yScale;\n\n      if (domainByTrait[trait][0] || domainByTrait[trait][0] == 0) {\n        //controllo se il minore Ã¨ un numero\n        xScale = d3.scaleLinear().domain(domainByTrait[trait]);\n        yScale = d3.scaleLinear().domain(domainByTrait[trait]);\n      } else {\n        let domain = props.data.map(l => l[trait]);\n        xScale = d3.scalePoint().domain([...new Set(domain)]);\n        yScale = d3.scalePoint().domain([...new Set(domain)]);\n      }\n\n      xScale.range([padding / 2, size - padding / 2]);\n      yScale.range([size - padding / 2, padding / 2]);\n      xScales[trait] = xScale;\n      yScales[trait] = yScale;\n    }); //calcola i massimi e i minimi\n  }\n\n  function updateAxis() {\n    svg.selectAll(\".x.axis\").remove();\n    svg.selectAll(\".x.axis\").data(traits).enter().append(\"g\").attr(\"class\", \"x axis\").attr(\"transform\", function (d, i) {\n      return \"translate(\" + (i * size + 20) + \",0)\";\n    }).each(function (d) {\n      xAxis = d3.axisBottom(xScales[d]).ticks(6) //quante tacchette sull'asse\n      .tickSize(size * numberOfTraits);\n      d3.select(this).call(xAxis);\n    });\n    svg.selectAll(\".y.axis\").remove();\n    svg.selectAll(\".y.axis\").data(traits).enter().append(\"g\").attr(\"class\", \"y axis\").attr(\"transform\", function (d, i) {\n      return \"translate(20,\" + i * size + \")\";\n    }).each(function (d) {\n      yAxis = d3.axisLeft(yScales[d]).ticks(6).tickSize(-size * numberOfTraits);\n      d3.select(this).call(yAxis);\n    });\n  }\n\n  function updatePoints() {\n    svg.selectAll(\".cell\").remove();\n    let cell = svg.selectAll(\".cell\").data(cross(traits, traits)) //quindi abbiamo tutte le possibili coppie tra le varie dimensioni selezionate\n    .enter().append(\"g\") //aggiungo un oggetto per ogni coppia\n    .attr(\"class\", \"cell\").attr(\"transform\", function (d) {\n      return \"translate(\" + (d.i * size + 20) + \",\" + d.j * size + \")\";\n    }) //creo il grafico in due dimensioni per ogni oggetto\n    .each(plot); //seleziono le celle con le due dimensioni uguali\n    //a queste celle aggiungo una label con il testo\n\n    cell.filter(function (d) {\n      return d.i === d.j;\n    }).append(\"text\").attr(\"x\", padding).attr(\"y\", padding).attr(\"dy\", \".71em\").text(function (d) {\n      return d.x;\n    });\n  }\n\n  function updateLegend() {\n    svg.selectAll('.legend').remove();\n    var legend = svg.selectAll('.legend').data(color.domain()).enter().append('g').attr('class', 'legend').attr('transform', function (d, i) {\n      var height = legendRectSize + legendSpacing;\n      var offset = padding;\n      var horz = size * numberOfTraits + padding;\n      var vert = i * height + offset;\n      return 'translate(' + horz + ',' + vert + ')';\n    });\n    legend.append('rect').attr('width', legendRectSize).attr('height', legendRectSize).style('fill', color).style('stroke', color);\n    legend.append('text').attr('x', legendRectSize + legendSpacing).attr('y', legendRectSize - legendSpacing).text(function (d) {\n      return d;\n    });\n  }\n\n  function update() {\n    updateScales();\n    updateAxis();\n    updatePoints();\n    updateLegend();\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"p-4\",\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      ref: node => {\n        refSvg = node;\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 13\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 167,\n    columnNumber: 9\n  }, this);\n}\n\n_s(ScatterPlotMatrix, \"OD7bBpZva5O2jO+Puf00hKivP7c=\");\n\n_c = ScatterPlotMatrix;\nScatterPlotMatrix.propTypes = {\n  data: PropTypes.array,\n  dims: PropTypes.array,\n  padding: PropTypes.number,\n  size: PropTypes.number,\n  radius: PropTypes.number,\n  color: PropTypes.string,\n  margin: PropTypes.object,\n  dim1Title: PropTypes.string,\n  dim2Title: PropTypes.string,\n  dim3Title: PropTypes.string,\n  dim4Title: PropTypes.string,\n  dimColor: PropTypes.string,\n  title: PropTypes.string\n};\nScatterPlotMatrix.defaultProps = {\n  data: [{\n    x: 10,\n    y: 20,\n    z: 10,\n    h: 20\n  }, {\n    x: 15,\n    y: 35,\n    z: 15,\n    h: 26\n  }],\n  padding: 20,\n  size: 180,\n  radius: 5,\n  color: \"blue\",\n  margin: {\n    left: 50,\n    right: 10,\n    top: 20,\n    bottom: 50\n  },\n  dim1Title: \"Dim 1 Title\",\n  dim2Title: \"Dim 2 Title\",\n  dim3Title: \"Dim 3 Title\",\n  dim4Title: \"Dim 4 Title\",\n  title: \"Prova\"\n};\n\nvar _c;\n\n$RefreshReg$(_c, \"ScatterPlotMatrix\");","map":{"version":3,"sources":["C:/Users/Admin/Desktop/poc/demoreact/src/components/SPM.js"],"names":["React","useEffect","d3","PropTypes","select","ScatterPlotMatrix","props","refSvg","svg","xAxis","yAxis","domainByTrait","yScales","xScales","size","padding","legendRectSize","legendSpacing","data","color","scaleOrdinal","schemeCategory10","traits","dims","numberOfTraits","length","console","log","dimColor","cross","a","b","c","n","m","i","j","push","x","y","plot","p","cell","append","attr","selectAll","enter","transition","duration","d","style","update","updateScales","forEach","trait","extent","xScale","yScale","scaleLinear","domain","map","l","scalePoint","Set","range","updateAxis","remove","each","axisBottom","ticks","tickSize","call","axisLeft","updatePoints","filter","text","updateLegend","legend","height","offset","horz","vert","node","propTypes","array","number","radius","string","margin","object","dim1Title","dim2Title","dim3Title","dim4Title","title","defaultProps","z","h","left","right","top","bottom"],"mappings":"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","sourcesContent":["import React, {useEffect} from \"react\";\r\nimport * as d3 from \"d3\"\r\nimport PropTypes from 'prop-types';\r\nimport { select} from \"d3\";\r\n\r\n\r\nexport default function ScatterPlotMatrix (props) {\r\n    \r\n    //Sono i riferimenti ai g che ho costruito nel return.\r\n    let refSvg, svg;\r\n    let xAxis, yAxis, domainByTrait={}, yScales={}, xScales={};\r\n    const size = props.size, padding = props.padding, legendRectSize = 18, legendSpacing = 4;\r\n    const data = props.data;\r\n    const color = d3.scaleOrdinal(d3.schemeCategory10);\r\n    const traits = props.dims;\r\n    const numberOfTraits = traits.length;\r\n\r\n    console.log(props.dimColor);\r\n    console.log(props.data);\r\n    console.log(props.dims);\r\n\r\n    function cross(a, b) {\r\n        var c = [], n = a.length, m = b.length, i, j;\r\n        for (i = -1; ++i < n;) \r\n            for (j = -1; ++j < m;) \r\n                c.push({x: a[i], \r\n                        i: i, \r\n                        y: b[j], \r\n                        j: j});\r\n        return c;\r\n    }\r\n    \r\n    function plot(p) {\r\n        var cell = d3.select(this);\r\n        cell.append(\"rect\")\r\n            .attr(\"class\", \"frame\")\r\n            .attr(\"x\", padding / 2)\r\n            .attr(\"y\", padding / 2)\r\n            .attr(\"width\", size - padding)\r\n            .attr(\"height\", size - padding);\r\n\r\n        cell.selectAll(\"circle\")\r\n            .data(data)\r\n            .enter().append(\"circle\")\r\n                .transition().duration(500)\r\n                .attr(\"cx\", function(d) { return xScales[p.x](d[p.x]); })\r\n                .attr(\"cy\", function(d) { return yScales[p.y](d[p.y]); })\r\n                .attr(\"r\", 4)\r\n                .style(\"fill\", function(d) { return color(d[props.dimColor]); });\r\n    }\r\n    useEffect(() => {\r\n        svg = select(refSvg);\r\n        svg.attr(\"width\", (size * numberOfTraits + padding + legendRectSize + 125))\r\n        svg.attr(\"height\", (size * numberOfTraits + padding))\r\n        //svg.attr(\"viewBox\", \"0 0 \" + (size * numberOfTraits + padding + legendRectSize + 125) + \" \" + (size * numberOfTraits + padding))\r\n        update();\r\n    })\r\n    function updateScales(){\r\n        traits.forEach(function(trait) {\r\n            domainByTrait[trait] = d3.extent(data, function(d) {return +d[trait]; });\r\n            let xScale, yScale;\r\n            if(domainByTrait[trait][0] || domainByTrait[trait][0]==0){//controllo se il minore Ã¨ un numero\r\n                xScale=d3.scaleLinear().domain(domainByTrait[trait])\r\n                yScale=d3.scaleLinear().domain(domainByTrait[trait])\r\n            }else{\r\n                let domain = props.data.map(l => l[trait]);\r\n                xScale=d3.scalePoint().domain([... new Set(domain)])\r\n                yScale=d3.scalePoint().domain([... new Set(domain)])\r\n            }\r\n            xScale.range([padding / 2, size - padding / 2]);\r\n            yScale.range([size - padding / 2, padding / 2]);\r\n            xScales[trait]=xScale;\r\n            yScales[trait]=yScale;\r\n        }); //calcola i massimi e i minimi\r\n        \r\n    }\r\n    function updateAxis(){\r\n        svg.selectAll(\".x.axis\").remove();\r\n        svg.selectAll(\".x.axis\")\r\n        .data(traits) \r\n        .enter() \r\n        .append(\"g\") \r\n            .attr(\"class\", \"x axis\")\r\n            .attr(\"transform\", function(d, i) { \r\n                return \"translate(\" + (i * size + 20)+\",0)\"; \r\n            })\r\n            .each(function(d) {\r\n                xAxis = d3.axisBottom(xScales[d])\r\n                    .ticks(6) //quante tacchette sull'asse\r\n                    .tickSize(size * numberOfTraits);\r\n                d3.select(this).call(xAxis);\r\n            });\r\n\r\n        svg.selectAll(\".y.axis\").remove();\r\n        svg.selectAll(\".y.axis\")\r\n        .data(traits)\r\n        .enter()\r\n        .append(\"g\")\r\n            .attr(\"class\", \"y axis\")\r\n            .attr(\"transform\", function(d, i) {\r\n                return \"translate(20,\" + i * size+\")\"; \r\n            })\r\n            .each(function(d) { \r\n                yAxis = d3.axisLeft(yScales[d])\r\n                    .ticks(6)\r\n                    .tickSize(-size * numberOfTraits);\r\n                d3.select(this).call(yAxis); \r\n            });\r\n    }\r\n    function updatePoints(){\r\n        svg.selectAll(\".cell\").remove();\r\n        let cell = svg.selectAll(\".cell\")\r\n            .data(cross(traits, traits))\r\n             //quindi abbiamo tutte le possibili coppie tra le varie dimensioni selezionate\r\n            .enter().append(\"g\")    //aggiungo un oggetto per ogni coppia\r\n                .attr(\"class\", \"cell\")\r\n                .attr(\"transform\", function(d) { \r\n                    return \"translate(\" + (d.i * size +20) + \",\" + d.j * size + \")\"; })\r\n             //creo il grafico in due dimensioni per ogni oggetto\r\n            .each(plot);\r\n            \r\n            //seleziono le celle con le due dimensioni uguali\r\n            //a queste celle aggiungo una label con il testo\r\n            cell.filter(function(d) { return d.i === d.j; }) \r\n            .append(\"text\")\r\n                .attr(\"x\", padding)\r\n                .attr(\"y\", padding)\r\n                .attr(\"dy\", \".71em\")\r\n            .text(function(d) { return d.x; });\r\n\r\n    }\r\n    function updateLegend(){\r\n        svg.selectAll('.legend').remove();\r\n        var legend = svg.selectAll('.legend')\r\n            .data(color.domain())\r\n            .enter()\r\n            .append('g')\r\n            .attr('class', 'legend')\r\n            .attr('transform', function (d, i) {\r\n                var height = legendRectSize + legendSpacing;\r\n                var offset = padding;\r\n                var horz = size * numberOfTraits + padding;\r\n                var vert = i * height + offset;\r\n                return 'translate(' + horz + ',' + vert + ')';\r\n            });\r\n            legend.append('rect')\r\n              .attr('width', legendRectSize)\r\n              .attr('height', legendRectSize)\r\n              .style('fill', color)\r\n              .style('stroke', color);\r\n     \r\n            legend.append('text')\r\n              .attr('x', legendRectSize + legendSpacing)\r\n              .attr('y', legendRectSize - legendSpacing)\r\n              .text(function (d) {\r\n                return d;\r\n              });\r\n\r\n    }\r\n    function update(){\r\n        updateScales();\r\n        updateAxis();\r\n        updatePoints();\r\n        updateLegend();\r\n    }\r\n    return (\r\n        <div className=\"p-4\">\r\n            <svg ref={(node) => { refSvg = node; }} >\r\n            </svg>\r\n        </div>\r\n    )\r\n}\r\nScatterPlotMatrix.propTypes = {\r\n    data : PropTypes.array,\r\n    dims: PropTypes.array,\r\n    padding: PropTypes.number,\r\n    size: PropTypes.number,\r\n    radius: PropTypes.number,\r\n    color: PropTypes.string,\r\n    margin: PropTypes.object,\r\n    dim1Title: PropTypes.string,\r\n    dim2Title: PropTypes.string,\r\n    dim3Title: PropTypes.string,\r\n    dim4Title: PropTypes.string,\r\n    dimColor: PropTypes.string,\r\n    title: PropTypes.string\r\n}\r\nScatterPlotMatrix.defaultProps = {\r\n    data: [{ x: 10, y: 20, z: 10, h: 20 }, { x: 15, y: 35, z: 15, h: 26  }],\r\n    padding: 20,\r\n    size: 180,\r\n    radius: 5,\r\n    color: \"blue\",\r\n    margin: {\r\n        left: 50,\r\n        right: 10,\r\n        top: 20,\r\n        bottom: 50\r\n    },\r\n    dim1Title: \"Dim 1 Title\",\r\n    dim2Title: \"Dim 2 Title\",\r\n    dim3Title: \"Dim 3 Title\",\r\n    dim4Title: \"Dim 4 Title\",\r\n    title: \"Prova\"\r\n};"]},"metadata":{},"sourceType":"module"}